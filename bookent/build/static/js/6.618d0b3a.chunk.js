(this.webpackJsonpbookent=this.webpackJsonpbookent||[]).push([[6],{100:function(e,t,o){"use strict";t.a=o.p+"static/media/read1.f92f6035.svg"},106:function(e,t,o){e.exports={themelight:"style_themelight__1CL3i",themedark:"style_themedark__kahU1",main:"style_main__WQqR_",books:"style_books__3wqRy",book:"style_book__YdEX3",upperdetails:"style_upperdetails__2Bnky",details:"style_details__3ohSl",bookname:"style_bookname__3DTeS",bookgen:"style_bookgen__3aiKN",booktime:"style_booktime__2ihmE",love:"style_love__11UZs",bookowner:"style_bookowner__1_RzB",booknum:"style_booknum__2i1H_",contacts:"style_contacts__1usKq",chat:"style_chat__2O1TC",bookcover:"style_bookcover__2Ft5c",lowerdetails:"style_lowerdetails__2jMxM",bookdesc:"style_bookdesc__BMTXb",ownerBooks:"style_ownerBooks__2waS7",bookdetails:"style_bookdetails__PhAtl"}},146:function(e,t,o){"use strict";o.r(t);var a=o(19),c=o.n(a),s=o(27),n=o(41),r=o(10),l=o(4),i=o(1),d=o(25),u=o(26),b=o.n(u),j=o(106),h=o.n(j),v=o(3),m=o.n(v),O=o(44),f=o(43),p=o(98),k=o(100),_=o(13),x=o(0),g=Object(i.lazy)((function(){return Promise.all([o.e(0),o.e(11)]).then(o.bind(null,144))}));var w=function(e){var t=e.book,o=e.user,a=e.addToFav,c=e.startConv,s=e.ownerBooks,n=!1;if((null===o||void 0===o?void 0:o.favList)&&(null===o||void 0===o?void 0:o.favList.length)>0)for(var r=0;r<(null===o||void 0===o?void 0:o.favList.length);r++)t._id===o.favList[r]._id&&(n=!0);function l(e){if((null===o||void 0===o?void 0:o.favList)&&(null===o||void 0===o?void 0:o.favList.length)>0)for(var t=0;t<(null===o||void 0===o?void 0:o.favList.length);t++)if(e===o.favList[t]._id)return!0}return Object(i.useEffect)((function(){window.scrollTo({top:0,behavior:"smooth"})}),[t]),Object(x.jsx)(x.Fragment,{children:Object(x.jsxs)("main",{className:h.a.book,children:[Object(x.jsxs)("div",{className:h.a.upperdetails,children:[Object(x.jsxs)("section",{className:h.a.details,children:[Object(x.jsx)("p",{className:h.a.bookname,children:t.bookName}),Object(x.jsxs)("p",{className:h.a.bookgen,children:["Genere : ",t.bookGenere]}),Object(x.jsxs)("p",{className:h.a.booktime,children:["Loan time : ",t.time," days"]}),Object(x.jsxs)("div",{className:h.a.love,children:[Object(x.jsx)("input",{type:"checkbox",checked:n,onChange:function(e){a(e.target.checked,t)}}),Object(x.jsx)("img",{src:"/assets/love.svg",alt:"add to favourites"})]}),Object(x.jsxs)("p",{className:h.a.bookowner,children:["Author : ",t.author]}),Object(x.jsxs)("p",{className:h.a.bookowner,children:["Year : ",t.Year]}),Object(x.jsxs)("p",{className:h.a.bookowner,children:["ISBN : ",t.isbn]}),Object(x.jsxs)("p",{className:h.a.bookowner,children:["Country :  ",t.country]}),Object(x.jsxs)("p",{className:h.a.bookowner,children:["Owner : ",t.owner]}),Object(x.jsxs)("div",{className:h.a.contacts,children:[Object(x.jsxs)("button",{className:h.a.booknum,onClick:function(){navigator.clipboard.writeText(t.ownerPhone),alert("phone copied !")},children:[Object(x.jsxs)("p",{children:[" ",t.ownerPhone]}),Object(x.jsx)("div",{children:Object(x.jsx)("img",{src:"/assets/phone.svg",alt:"number phone"})})]}),o._id!=t.ownerId&&Object(x.jsx)("button",{onClick:c,className:h.a.chat,children:Object(x.jsx)("img",Object(p.a)({src:"/assets/message.svg",alt:"message"},"alt","chat"))})]})]}),Object(x.jsx)("section",{className:h.a.bookcover,children:Object(x.jsx)("img",{src:t.coverPhoto?"".concat("http://localhost:3001","/booksImages/").concat(t.coverPhoto):"".concat(k.a),alt:t.bookName})})]}),Object(x.jsxs)("div",{className:h.a.lowerdetails,children:[Object(x.jsx)("p",{className:h.a.bookdesc,children:t.description}),Object(x.jsx)("div",{className:h.a.bookLocation,children:Object(x.jsx)(g,{GeoLA:t.location[0].split(",")[0],GeoLO:t.location[0].split(",")[1]})}),(null===s||void 0===s?void 0:s.length)>1&&Object(x.jsxs)("div",{className:h.a.ownerBooks,children:[Object(x.jsx)("h4",{children:"Also by this user :"}),s&&s.map((function(e){return e._id!=t._id&&Object(x.jsx)("div",{className:h.a.book,style:{backgroundImage:e.coverPhoto?"url(".concat("http://localhost:3001","/booksImages/").concat(e.coverPhoto,")"):"url(".concat(k.a,")")},children:Object(x.jsxs)("div",{className:h.a.bookdetails,children:[Object(x.jsx)(_.b,{to:{pathname:"/Book/".concat(e._id),state:{book:e}},children:Object(x.jsx)("p",{className:h.a.bookname,children:e.bookName})}),Object(x.jsxs)("div",{className:h.a.love,children:[Object(x.jsx)("input",{type:"checkbox",checked:l(e._id),onChange:function(t){a(t.target.checked,e)}}),Object(x.jsx)("img",{src:"/assets/love.svg",alt:"add to favourites"})]}),Object(x.jsxs)("p",{className:h.a.bookgen,children:["Genere: ",e.bookGenere]}),Object(x.jsx)("p",{className:h.a.bookdesc,children:e.description})]})})}))]})]})]})})},N=o(56),y=o(57);t.default=Object(l.i)((function(){var e=Object(l.h)(),t=(e.state?e.state:null).book,o=Object(i.useContext)(d.a),a=o.user,u=o.setuser,j=o.connected,v=o.setconnected,p="";a&&(p=a._id);var k=Object(i.useState)([]),_=Object(r.a)(k,2),g=_[0],S=_[1],I=Object(i.useState)(null),C=Object(r.a)(I,2),T=C[0],E=C[1],A=Object(i.useState)([]),P=Object(r.a)(A,2),L=P[0],B=P[1],R=Object(i.useState)(""),F=Object(r.a)(R,2),D=F[0],M=F[1],H=Object(i.useState)(null),G=Object(r.a)(H,2),U=G[0],J=G[1],K=Object(i.useState)({}),W=Object(r.a)(K,2),q=W[0],Y=W[1],z=Object(i.useState)(!1),V=Object(r.a)(z,2),X=V[0],Q=V[1],Z=Object(i.useRef)(),$=Object(i.useRef)(),ee=Object(i.useState)(!1),te=Object(r.a)(ee,2),oe=te[0],ae=te[1];Object(i.useLayoutEffect)((function(){var e=localStorage.getItem("theme");document.documentElement.className="themelight"===e.toString()?h.a.themelight:h.a.themedark,window.scrollTo({top:0,behavior:"smooth"})}),[]),Object(i.useEffect)((function(){var e;b.a.get("".concat("http://localhost:3001","/getOwner/").concat(t.ownerId),{headers:{"x-access-token":null===(e=JSON.parse(localStorage.getItem("token")))||void 0===e?void 0:e.token}}).then((function(e){Y(e.data)}))}),[]),Object(i.useEffect)((function(){j&&window.location.reload()}),[]),Object(i.useEffect)((function(){Z.current=Object(y.a)("ws:".concat(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"http://localhost:3001",REACT_APP_CHAT_API:"//localhost:8900"}).CHAT_API)),v(!0),Z.current.on("getMessage",(function(e){J({sender:e.senderId,text:e.text,createdAt:e.createdAt})}))}),[]),Object(i.useEffect)((function(){U&&(null===T||void 0===T?void 0:T.members.includes(U.sender))&&B((function(e){return[].concat(Object(n.a)(e),[U])}))}),[U,T]),Object(i.useEffect)((function(){Z.current.emit("addUser",p)}),[a,X]),Object(i.useEffect)((function(){var e=function(){var e=Object(s.a)(c.a.mark((function e(){var o,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.a.get("".concat("http://localhost:3001","/getConv/").concat(p));case 3:o=e.sent,a=o.data.filter((function(e){return e.members[1]===t.ownerId})),S(a),E(a[0]),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();e()}),[p,X]),Object(i.useEffect)((function(){var e=function(){var e=Object(s.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.a.get("".concat("http://localhost:3001","/getMsg/").concat(null===T||void 0===T?void 0:T._id));case 3:t=e.sent,B(t.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();e()}),[T]);var ce=function(){var e=Object(s.a)(c.a.mark((function e(t){var o,a,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!D){e.next=16;break}return o={sender:p,text:D,conversationId:T._id,createdAt:Date.now()},a=T.members.find((function(e){return e!==p})),Z.current.emit("sendMessage",{senderId:p,receiverId:a,text:D,createdAt:Date.now()}),e.prev=5,e.next=8,b.a.post("".concat("http://localhost:3001","/addMsg/"),{message:o});case 8:s=e.sent,B([].concat(Object(n.a)(L),[s.data])),M(""),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(t){return e.apply(this,arguments)}}();return Object(i.useEffect)((function(){var e;null===(e=$.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[L,oe]),Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(O.default,{}),Object(x.jsx)("div",{className:h.a.main,children:Object(x.jsx)("div",{className:h.a.books,children:Object(x.jsx)(w,{book:t,user:a,addToFav:function(e,t){var o,c;e?b.a.put("".concat("http://localhost:3001","/addToFav"),{book:t,user:a},{headers:{"x-access-token":null===(o=JSON.parse(localStorage.getItem("token")))||void 0===o?void 0:o.token}}).then((function(e){return u(e.data)})).catch((function(e){return console.log(e)})):b.a.put("".concat("http://localhost:3001","/removeToFav"),{book:t,user:a},{headers:{"x-access-token":null===(c=JSON.parse(localStorage.getItem("token")))||void 0===c?void 0:c.token}}).then((function(e){return u(e.data)})).catch((function(e){return console.log(e)}))},startConv:function(e){if(ae(!0),0===g.length){var o=p,a=t.ownerId;b.a.post("".concat("http://localhost:3001","/newConv"),{senderId:o,receiverId:a}).then(Q(!0)).catch()}},ownerBooks:q.booksList})})}),p!=t.ownerId&&oe&&Object(x.jsx)("div",{className:m.a.messengerSmall,children:Object(x.jsx)("div",{className:m.a.chatBox,children:Object(x.jsxs)("div",{className:m.a.chatBoxWrapper,children:[(null===q||void 0===q?void 0:q.username)&&Object(x.jsxs)("div",{className:m.a.chatHeader,children:[Object(x.jsx)("img",{src:(null===q||void 0===q?void 0:q.profileImg)?"".concat("http://localhost:3001","/usersImages/").concat(q.profileImg):"/assets/user.svg",alt:"user"}),Object(x.jsx)("span",{children:null===q||void 0===q?void 0:q.username})]}),T?Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("div",{className:m.a.chatBoxTop,children:L.map((function(e){return Object(x.jsx)("div",{ref:$,children:Object(x.jsx)(N.a,{message:e,own:e.sender===p,owner:e.sender===p?a:q})})}))}),Object(x.jsxs)("div",{className:m.a.chatBoxBottom,children:[Object(x.jsx)("textarea",{className:m.a.chatMessageInput,placeholder:"write something...",onChange:function(e){return M(e.target.value)},value:D}),Object(x.jsx)("button",{className:m.a.chatSubmitButton,onClick:ce,children:Object(x.jsx)("img",{src:"/assets/send.svg",alt:"send"})})]})]}):Object(x.jsx)("span",{className:m.a.noConversationText,children:"Open a conversation to start a chat."})]})})}),Object(x.jsx)(f.default,{})]})}))},98:function(e,t,o){"use strict";function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}o.d(t,"a",(function(){return a}))}}]);
//# sourceMappingURL=6.618d0b3a.chunk.js.map